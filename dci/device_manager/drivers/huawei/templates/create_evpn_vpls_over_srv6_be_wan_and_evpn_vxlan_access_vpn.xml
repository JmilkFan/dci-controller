<?xml version="1.0" encoding="UTF-8"?>
<rpc message-id="cli2xml-6" xmlns="urn:ietf:params:xml:ns:netconf:base:1.0">
  <edit-config>
    <target>
      <candidate/>
    </target>
    <default-operation>merge</default-operation>
    <test-option>test-then-set</test-option>
    <error-option>rollback-on-error</error-option>
    <config xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0">
      <bd xmlns="urn:huawei:yang:huawei-bd">
        <instances>
          <instance nc:operation="create">
            <id>{{ WAN_VPN_BD }}</id>
            <admin-status>up</admin-status>
            <statistic-enable>disable</statistic-enable>
            <broadcast-discard>disable</broadcast-discard>
            <unknown-multicast-discard>disable</unknown-multicast-discard>
            <unknown-unicast-discard>disable</unknown-unicast-discard>
            <mac-learning>enable</mac-learning>
            <split-horizon>disable</split-horizon>
            <service-points>
              <service-point nc:operation="create">
                <interface-name>{{ PRESET_WAN_VPN_BD_INTERFACE }}.{{ WAN_VPN_BD }}</interface-name>
                <split-horizon>disable</split-horizon>
                <evpn xmlns="urn:huawei:yang:huawei-evpn" nc:operation="merge">
                  <e-tree-leaf>false</e-tree-leaf>
                </evpn>
              </service-point>
            </service-points>
            <evpn xmlns="urn:huawei:yang:huawei-evpn" nc:operation="create">
              <name>{{ WAN_VPN_NAME }}</name>
            </evpn>
          </instance>
          <instance nc:operation="create">
            <id>{{ ACCESS_VPN_BD }}</id>
            <admin-status>up</admin-status>
            <statistic-enable>disable</statistic-enable>
            <broadcast-discard>disable</broadcast-discard>
            <unknown-multicast-discard>disable</unknown-multicast-discard>
            <unknown-unicast-discard>disable</unknown-unicast-discard>
            <mac-learning>enable</mac-learning>
            <split-horizon>disable</split-horizon>
            <service-points>
              <service-point nc:operation="create">
                <interface-name>{{ PRESET_ACCESS_VPN_BD_INTERFACE }}.{{ ACCESS_VPN_BD }}</interface-name>
                <split-horizon>disable</split-horizon>
                <evpn xmlns="urn:huawei:yang:huawei-evpn" nc:operation="merge">
                  <e-tree-leaf>false</e-tree-leaf>
                </evpn>
              </service-point>
            </service-points>
            <nvo3 xmlns="urn:huawei:yang:huawei-nvo3">
              <vni-list nc:operation="create">
                <vni>{{ ACCESS_VPN_VXLAN_VNI }}</vni>
                <split-horizon>true</split-horizon>
              </vni-list>
            </nvo3>
            <evpn xmlns="urn:huawei:yang:huawei-evpn" nc:operation="create">
              <name>{{ ACCESS_VPN_NAME }}</name>
            </evpn>
          </instance>
        </instances>
      </bd>
      <evpn xmlns="urn:huawei:yang:huawei-evpn">
        <instances>
          <instance nc:operation="create">
            <name>{{ WAN_VPN_NAME }}</name>
            <type>bd-evpn</type>
            <bd-evpn nc:operation="create">
              <rd>{{ WAN_VPN_RD }}</rd>
              <local-remote-frr>default</local-remote-frr>
              <mac-balance-enable>false</mac-balance-enable>
              <bypass-vxlan>default</bypass-vxlan>
              <etree-enable>false</etree-enable>
              <srv6-mode>be</srv6-mode>
              <control-word>false</control-word>
              <rts>
                <rt nc:operation="create">
                  <vrf-rt-type>export-extcommunity</vrf-rt-type>
                  <vrf-rt-value>{{ WAN_VPN_RT }}</vrf-rt-value>
                </rt>
                <rt nc:operation="create">
                  <vrf-rt-type>import-extcommunity</vrf-rt-type>
                  <vrf-rt-value>{{ WAN_VPN_RT }}</vrf-rt-value>
                </rt>
              </rts>
              <locator xmlns="urn:huawei:yang:huawei-evpn-srv6" nc:operation="create">
                <srv6-locator>{{ PRESET_SRV6_LOCATOR_ARG }}</srv6-locator>
                <unicast-locator>{{ PRESET_SRV6_LOCATOR }}</unicast-locator>
              </locator>
            </bd-evpn>
            <mac-limit xmlns="urn:huawei:yang:huawei-macm">
              <alarm-threshold nc:operation="create">
                <lower>70</lower>
                <upper>80</upper>
              </alarm-threshold>
            </mac-limit>
          </instance>
          <instance nc:operation="create">
            <name>{{ ACCESS_VPN_NAME }}</name>
            <type>bd-evpn</type>
            <bd-evpn nc:operation="create">
              <rd>{{ ACCESS_VPN_RD }}</rd>
              <local-remote-frr>default</local-remote-frr>
              <mac-balance-enable>false</mac-balance-enable>
              <bypass-vxlan>default</bypass-vxlan>
              <etree-enable>false</etree-enable>
              <control-word>false</control-word>
              <rts>
                <rt nc:operation="create">
                  <vrf-rt-type>export-extcommunity</vrf-rt-type>
                  <vrf-rt-value>{{ ACCESS_VPN_RT }}</vrf-rt-value>
                </rt>
                <rt nc:operation="create">
                  <vrf-rt-type>import-extcommunity</vrf-rt-type>
                  <vrf-rt-value>{{ ACCESS_VPN_RT }}</vrf-rt-value>
                </rt>
              </rts>
            </bd-evpn>
            <mac-limit xmlns="urn:huawei:yang:huawei-macm">
              <alarm-threshold nc:operation="create">
                <lower>70</lower>
                <upper>80</upper>
              </alarm-threshold>
            </mac-limit>
          </instance>
        </instances>
      </evpn>
      <ifm xmlns="urn:huawei:yang:huawei-ifm">
        <interfaces>
          <interface nc:operation="create">
            <name>{{ PRESET_WAN_VPN_BD_INTERFACE }}.{{ WAN_VPN_BD }}</name>
            <class>sub-interface</class>
            <type>GigabitEthernet</type>
            <parent-name>{{ PRESET_WAN_VPN_BD_INTERFACE }}</parent-name>
            <number>{{ WAN_VPN_BD }}</number>
            <admin-status>up</admin-status>
            <link-protocol>ethernet</link-protocol>
            <router-type>broadcast</router-type>
            <clear-ip-df>false</clear-ip-df>
            <link-up-down-trap-enable>true</link-up-down-trap-enable>
            <statistic-enable>false</statistic-enable>
            <statistic-mode>interface-based</statistic-mode>
            <spread-mtu-flag>false</spread-mtu-flag>
            <vrf-name>_public_</vrf-name>
            <l2-mode-enable>true</l2-mode-enable>
            <ethernet xmlns="urn:huawei:yang:huawei-ethernet">
              <l2-sub-interface nc:operation="create">
                <local-switch>disable</local-switch>
                <dot1q nc:operation="create">
                  <vlans nc:operation="create">
                    <vlan-list>{{ SPLICING_VID }}</vlan-list>
                  </vlans>
                </dot1q>
              </l2-sub-interface>
            </ethernet>
            <multicast-bas xmlns="urn:huawei:yang:huawei-multicast-bas" nc:operation="create">
              <authorization-enable>false</authorization-enable>
            </multicast-bas>
          </interface>
          <interface nc:operation="create">
            <name>{{ PRESET_ACCESS_VPN_BD_INTERFACE }}.{{ ACCESS_VPN_BD }}</name>
            <class>sub-interface</class>
            <type>GigabitEthernet</type>
            <parent-name>{{ PRESET_ACCESS_VPN_BD_INTERFACE }}</parent-name>
            <number>{{ ACCESS_VPN_BD }}</number>
            <admin-status>up</admin-status>
            <link-protocol>ethernet</link-protocol>
            <router-type>broadcast</router-type>
            <clear-ip-df>false</clear-ip-df>
            <link-up-down-trap-enable>true</link-up-down-trap-enable>
            <statistic-enable>false</statistic-enable>
            <statistic-mode>interface-based</statistic-mode>
            <spread-mtu-flag>false</spread-mtu-flag>
            <vrf-name>_public_</vrf-name>
            <l2-mode-enable>true</l2-mode-enable>
            <ethernet xmlns="urn:huawei:yang:huawei-ethernet">
              <l2-sub-interface nc:operation="create">
                <local-switch>disable</local-switch>
                <dot1q nc:operation="create">
                  <vlans nc:operation="create">
                    <vlan-list>{{ SPLICING_VID }}</vlan-list>
                  </vlans>
                </dot1q>
              </l2-sub-interface>
            </ethernet>
            <multicast-bas xmlns="urn:huawei:yang:huawei-multicast-bas" nc:operation="create">
              <authorization-enable>false</authorization-enable>
            </multicast-bas>
          </interface>
        </interfaces>
      </ifm>
      <network-instance xmlns="urn:huawei:yang:huawei-network-instance">
        <instances>
          <instance>
            <name>_public_</name>
            <srv6 xmlns="urn:huawei:yang:huawei-srv6">
              <locators>
                <locator nc:operation="merge">
                  <name>{{ PRESET_SRV6_LOCATOR }}</name>
                  <prefix>{{ PRESET_SRV6_LOCATOR_PREFIX }}</prefix>
                  <prefix-length>{{ PRESET_SRV6_LOCATOR_PREFIX_LEN }}</prefix-length>
                  <static-length>0</static-length>
                  <args-length>0</args-length>
                </locator>
                <locator nc:operation="merge">
                  <name>{{ PRESET_SRV6_LOCATOR_ARG }}</name>
                  <prefix>{{ PRESET_SRV6_LOCATOR_ARG_PREFIX }}</prefix>
                  <prefix-length>{{ PRESET_SRV6_LOCATOR_ARG_PREFIX_LEN }}</prefix-length>
                  <static-length>0</static-length>
                  <args-length>10</args-length>
                </locator>
              </locators>
              <global-ipv6uc-attribute xmlns="urn:huawei:yang:huawei-unicast-fwd-srv6" nc:operation="merge">
                <srv6-ttl-mode>pipe</srv6-ttl-mode>
              </global-ipv6uc-attribute>
            </srv6>
          </instance>
        </instances>
      </network-instance>
      <nvo3 xmlns="urn:huawei:yang:huawei-nvo3">
        <vni-instances>
          <vni-instance nc:operation="create">
            <vni>{{ ACCESS_VPN_VXLAN_VNI }}</vni>
            <source-nve>{{ PRESET_VXLAN_NVE_INTERFACE }}</source-nve>
            <protocol-bgp>peer</protocol-bgp>
            <static-peers>
              <static-peer nc:operation="create">
                <address>{{ PRESET_VXLAN_NVE_PEER_IP_ADDRESS }}</address>
              </static-peer>
            </static-peers>
          </vni-instance>
        </vni-instances>
      </nvo3>
    </config>
  </edit-config>
</rpc>
